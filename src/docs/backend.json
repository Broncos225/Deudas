
{
  "entities": {
    "Debt": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Debt",
      "type": "object",
      "description": "Represents a debt record, including details about the debtor, amount, and associated payments and images.",
      "properties": {
        "debtorId": {
          "type": "string",
          "description": "The ID of the debtor."
        },
        "debtorName": {
            "type": "string",
            "description": "The denormalized name of the debtor for easy display."
        },
        "concept": {
          "type": "string",
          "description": "A brief description of what the debt is for."
        },
        "amount": {
          "type": "number",
          "description": "The total amount of the debt."
        },
        "currency": {
          "type": "string",
          "description": "The currency of the debt (e.g., 'COP', 'USD')."
        },
        "type": {
          "type": "string",
          "description": "The type of debt: 'iou' (I owe you) or 'uome' (you owe me).",
          "enum": ["iou", "uome"]
        },
        "createdAt": {
          "type": "string",
          "description": "The date when the debt was created.",
          "format": "date-time"
        },
        "dueDate": {
            "type": "string",
            "description": "The optional due date for the debt.",
            "format": "date-time"
        },
        "receiptUrl": {
          "type": "string",
          "description": "URL of the receipt image.",
          "format": "uri"
        },
        "items": {
            "type": "array",
            "description": "An optional list of items detailing the composition of the debt.",
            "items": {
                "$ref": "#/entities/Item"
            }
        },
        "payments": {
            "type": "array",
            "items": {
                "$ref": "#/entities/Payment"
            }
        },
        "userId": {
            "type": "string",
            "description": "The ID of the user who owns this debt (for private debts or to identify the creator of a shared debt)."
        },
        "userOneId": {
            "type": "string",
            "description": "The UID of the first user in a shared debt, sorted lexicographically."
        },
        "userTwoId": {
            "type": "string",
            "description": "The UID of the second user in a shared debt, sorted lexicographically."
        },
        "participants": {
            "type": "array",
            "description": "An array containing the UIDs of both users involved in a shared debt, for efficient querying.",
            "items": {
                "type": "string"
            }
        },
        "isShared": {
            "type": "boolean",
            "description": "Flag to identify if the debt is shared between two users."
        },
        "isSettled": {
            "type": "boolean",
            "description": "Flag to know if a debt was part of a settlement"
        },
        "settlementId": {
            "type": "string",
            "description": "Which settlement it was part of"
        },
        "status": {
            "type": "string",
            "description": "The approval status of a shared debt.",
            "enum": ["pending", "approved", "rejected"]
        },
        "approvedBy": {
            "type": "array",
            "description": "List of user UIDs who have approved the debt.",
            "items": {
                "type": "string"
            }
        },
        "rejectedBy": {
            "type": "string",
            "description": "The UID of the user who rejected the debt."
        },
        "rejectionReason": {
            "type": "string",
            "description": "The reason why the debt was rejected."
        },
        "deletionStatus": {
            "type": "string",
            "description": "The consensus deletion status of a shared debt.",
            "enum": ["none", "requested"]
        },
        "deletionRequestedBy": {
            "type": "string",
            "description": "The UID of the user who requested the deletion."
        }
      },
      "required": [
        "debtorId",
        "debtorName",
        "concept",
        "amount",
        "currency",
        "type",
        "createdAt"
      ]
    },
    "Item": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "Item",
        "type": "object",
        "description": "Represents a single item within a debt, such as a product or a specific concept with its own value.",
        "properties": {
          "name": {
            "type": "string",
            "description": "The name of the product or concept."
          },
          "value": {
            "type": "number",
            "description": "The cost of this specific item."
          }
        },
        "required": [
          "name",
          "value"
        ]
    },
    "Payment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Payment",
      "type": "object",
      "description": "Represents a payment made towards a debt.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Payment entity."
        },
        "amount": {
          "type": "number",
          "description": "The amount paid."
        },
        "date": {
          "type": "string",
          "description": "The date when the payment was made.",
          "format": "date-time"
        },
        "receiptUrl": {
          "type": "string",
          "description": "URL of the payment receipt image.",
          "format": "uri"
        },
        "isSettlement": {
            "type": "boolean",
            "description": "Flag to identify settlement payments."
        },
        "settlementId": {
            "type": "string",
            "description": "ID of the settlement event."
        }
      },
      "required": [
        "id",
        "amount",
        "date"
      ]
    },
    "Debtor": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Debtor",
      "type": "object",
      "description": "Represents the person or entity that owes the debt.",
      "properties": {
        "name": {
          "type": "string",
          "description": "The name of the debtor."
        },
        "contact": {
          "type": "string",
          "description": "Contact information for the debtor (e.g., phone number, email address)."
        },
        "type": {
          "type": "string",
          "description": "The type of contact: 'person' or 'entity'.",
          "enum": ["person", "entity"]
        },
        "userId": {
          "type": "string",
          "description": "The ID of the user who owns this debtor."
        },
        "paymentMethod": {
            "type": "string",
            "description": "The preferred payment method for the debtor.",
            "enum": ["Efectivo", "Transferencia", "Tarjeta", "Otro"]
        },
        "paymentInfo": {
            "type": "string",
            "description": "Details for the payment method, like an account number."
        },
        "isAppUser": {
            "type": "boolean",
            "description": "Whether the contact is linked to an app user account."
        },
        "appUserId": {
            "type": "string",
            "description": "The Firebase UID of the linked app user."
        }
      },
      "required": [
        "name",
        "type",
        "userId"
      ]
    },
    "Settlement": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "Settlement",
        "type": "object",
        "description": "Represents a settlement event where debts between a user and a debtor are crossed.",
        "properties": {
          "id": {
            "type": "string",
            "description": "Unique identifier for the Settlement event."
          },
          "debtorId": {
            "type": "string",
            "description": "The ID of the debtor involved in the settlement."
          },
          "date": {
            "type": "string",
            "description": "The date when the settlement occurred.",
            "format": "date-time"
          },
          "amountSettled": {
            "type": "number",
            "description": "The total amount that was mutually cancelled out."
          },
          "currency": {
            "type": "string",
            "description": "The currency of the settlement."
          },
          "newDebtId": {
            "type": "string",
            "description": "The ID of the new debt created for the remaining balance, if any."
          },
          "userId": {
            "type": "string",
            "description": "The ID of the user who performed the settlement."
          }
        },
        "required": [
          "id",
          "debtorId",
          "date",
          "amountSettled",
          "currency",
          "userId"
        ]
    },
    "ActivityLog": {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "title": "Activity Log",
        "type": "object",
        "description": "Records an event related to a shared debt.",
        "properties": {
            "debtId": {
                "type": "string",
                "description": "The ID of the shared debt this log refers to."
            },
            "userId": {
                "type": "string",
                "description": "The ID of the user who performed the action."
            },
            "userName": {
                "type": "string",
                "description": "The denormalized name of the user for display."
            },
            "message": {
                "type": "string",
                "description": "A human-readable message describing the activity."
            },
            "timestamp": {
                "type": "string",
                "description": "When the activity occurred.",
                "format": "date-time"
            },
            "participants": {
                "type": "array",
                "description": "An array containing the UIDs of both users involved in the debt for querying.",
                "items": {
                    "type": "string"
                }
            }
        },
        "required": [
            "debtId",
            "userId",
            "userName",
            "message",
            "timestamp",
            "participants"
        ]
    }
  },
  "auth": {
    "providers": [
      "google.com"
    ]
  },
  "firestore": {
    "collections": [
      {
        "path": "/users/{userId}/debtors/{debtorId}",
        "schema": {
          "$ref": "#/entities/Debtor"
        },
        "description": "Stores information about the people or entities who owe money."
      },
      {
        "path": "/users/{userId}/debts/{debtId}",
        "schema": {
          "$ref": "#/entities/Debt"
        },
        "description": "Stores the individual private debt records for a user."
      },
      {
        "path": "/debts_shared/{debtId}",
        "schema": {
          "$ref": "#/entities/Debt"
        },
        "description": "Stores debt records shared between two users."
      },
      {
        "path": "/users/{userId}/settlements/{settlementId}",
        "schema": {
          "$ref": "#/entities/Settlement"
        },
        "description": "Stores the history of debt settlement events."
      },
      {
        "path": "/activity_logs/{logId}",
        "schema": {
          "$ref": "#/entities/ActivityLog"
        },
        "description": "Stores activity logs for shared debts."
      }
    ]
  }
}
